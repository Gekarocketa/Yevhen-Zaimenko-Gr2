<div th:fragment="subjects-panel" id="subjects-panel"
    style="position: fixed; left: 0; top: 0; height: 100vh; width: 260px; background: #232323; color: #fff; box-shadow: 2px 0 16px #0005; z-index: 1000; padding: 32px 18px 18px 18px; display: flex; flex-direction: column; gap: 12px; transform: translateX(-100%); transition: transform 0.3s cubic-bezier(.4,0,.2,1);"
    xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <div class="subject-panel__header"
        style="display: flex; justify-content: space-between; align-items: center; padding: 0 18px 12px 18px; border-bottom: 1px solid #333;">
        <h3 style="font-size: 1.3em; font-weight: 700;">Twoje przedmioty</h3>
        <a sec:authorize="hasRole('TUTOR')" th:href="@{/subjects}" title="Zarządzaj wszystkimi przedmiotami"
            style="font-size: 2em; color: #4eae6e; text-decoration: none; background: #232323; border-radius: 50%; width: 44px; height: 44px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 8px #0002;">⚙️</a>
    </div>

    <div style="display: flex; gap: 5px; margin-bottom: 10px; align-items: center;">
        <input type="text" id="przedmioty-szukaj" placeholder="Szukaj przedmiotów..."
            style="flex-grow: 1; padding: 5px; border: 1px solid #ccc; border-radius: 4px; color: #333;">
        <span id="przedmioty-filtr-przycisk" style="cursor: pointer; color: #fff; font-size: 1.5em;">&#9660;</span>
    </div>

    <!-- Filter options logic skipped for brevity, can be added back -->

    <div th:each="subject : ${availableSubjects}" class="subject-item" th:data-id="${subject.id}"
        th:data-semester="${subject.semester}"
        style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 8px 10px; border-radius: 8px; border: 2px solid transparent; transition: background 0.2s;">
        <span
            th:style="'display:inline-block;width:18px;height:18px;border-radius:4px;background:' + ${subject.color}"></span>
        <span style="font-weight: 600;" th:text="${subject.name}">Name</span>
    </div>

    <script th:inline="javascript">
        window.selectedSubjectId = null;

        document.querySelectorAll('.subject-item').forEach(item => {
            item.addEventListener('click', function () {
                // Toggle selection
                if (this.classList.contains('selected')) {
                    this.classList.remove('selected');
                    this.style.borderColor = 'transparent';
                    this.style.background = 'transparent';
                    window.selectedSubjectId = null;
                } else {
                    // Deselect others
                    document.querySelectorAll('.subject-item').forEach(i => {
                        i.classList.remove('selected');
                        i.style.borderColor = 'transparent';
                        i.style.background = 'transparent';
                    });

                    this.classList.add('selected');
                    this.style.borderColor = '#4ae';
                    this.style.background = 'rgba(74, 174, 238, 0.1)';
                    window.selectedSubjectId = this.getAttribute('data-id');
                }
            });
        });

        function toggleSubjectsPanel() {
            const panel = document.getElementById('subjects-panel');
            if (panel.style.transform === 'translateX(0%)') {
                panel.style.transform = 'translateX(-100%)';
            } else {
                panel.style.transform = 'translateX(0%)';
            }
        }
    </script>

    <div th:if="${#lists.isEmpty(availableSubjects)}" style="color:#bdbdbd; text-align:center;">Brak przedmiotów</div>
</div>